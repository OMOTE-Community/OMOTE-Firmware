* Config Module
The /Config Module/ for OMOTE introduces the option to define the
remote's functionality such as the controlled [[id:1670942e-7200-444a-992d-83effa554bc4][Devices]] and [[id:986aceb5-0da2-4742-b214-d283626730a4][Scenes]] in a
declarative way (using a YAML configuration file) instead of the
standard imperative approach based on defining the respective
configurations by implementing respective functions and data
structures as code.

Please note that while, in principle, the [[id:1670942e-7200-444a-992d-83effa554bc4][Devices]] and [[id:986aceb5-0da2-4742-b214-d283626730a4][Scenes]] defined
declaratively can live side-by-side with code driven definitions, it
is not advised as certain functionality (such as [[id:329ebe8e-23b2-4d34-9650-8ddbf8cc4c05][Device List]]
or [[id:5fe5b25c-59bb-4022-96a0-005d0a06de95][Automated Power on/off]]) will not be available for the imperative
definitions.




** Devices
:PROPERTIES:
:ID:       1670942e-7200-444a-992d-83effa554bc4
:END:
Devices defined via the configuration file (see [[id:60e6d396-dd8a-4dd1-a145-da4f5abc01e3][Schema]]) are equivalent
to the code driven definitions that live in =src/devices=. In addition
to the standard set of attributes and customization options inherited
from the imperative device definitions, the configuration driven
device definitions also allow to define a standard key-map for the
device (see =map_short= and =map_long= attributes in the [[id:60e6d396-dd8a-4dd1-a145-da4f5abc01e3][Schema]]) that
can be used as a convenient baseline for a scene key-map (see =scene= /
=keys_default= attribute) and will be used in the [[id:329ebe8e-23b2-4d34-9650-8ddbf8cc4c05][Device List]].

Each command defined within a device configuration, may also include a
new =category= attribute (see [[id:60e6d396-dd8a-4dd1-a145-da4f5abc01e3][Schema]]) that is used to enable the [[id:5fe5b25c-59bb-4022-96a0-005d0a06de95][Automated Power on/off]] capability.

*** Device List
:PROPERTIES:
:ID:       329ebe8e-23b2-4d34-9650-8ddbf8cc4c05
:END:
The /Device List/ is a new top-level GUI screen which aggregates all
devices defined in the configuration file with their commands. The GUI
is presented as a list of devices which expands to the list of their
respective commands once a device is "clicked". As long as a device is
expanded, the physical key-map will be replaced with the key mappings
from that device definition (if available). The key-map will be
restored to default once a device command list is "closed"
(collapsed).

** Scenes
:PROPERTIES:
:ID:       986aceb5-0da2-4742-b214-d283626730a4
:END:
*** Automated Power on/off
:PROPERTIES:
:ID:       5fe5b25c-59bb-4022-96a0-005d0a06de95
:END:
** Schema
:PROPERTIES:
:ID:       60e6d396-dd8a-4dd1-a145-da4f5abc01e3
:END:

| Entity        | Attribute      | Type                                           | Description                                                                                                                                                                                                                                                                                  |
|---------------+----------------+------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| =devices=     |                | dictionary: string -> =device=                 | A dictionary mapping a string representing the unique identifier for a device to a corresponding =device= object                                                                                                                                                                             |
|---------------+----------------+------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| =device=      | =display_name= | string                                         | The display name for this device in UI                                                                                                                                                                                                                                                       |
|               | =protocol=     | enum(string)                                   | The default protocol used in commands communicating with the device. Currently list: SIRC, NEC, RCS, DENON, KASEIKYO (easily expandable in config/parser.cpp)                                                                                                                                |
|               | =commands=     | list: =command=                                | The list of =command= objects defined for the device                                                                                                                                                                                                                                         |
|---------------+----------------+------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| =command=     | =name=         | string                                         | The name of the command. Will be used both for UI and internal accounting.                                                                                                                                                                                                                   |
|               | =data=         | hex number                                     | The data to be sent for the command based on the supported protocol.                                                                                                                                                                                                                         |
|               | =protocol=     | (optional) enum(string)                        | Overwrites the =device= / =protocol= if specified                                                                                                                                                                                                                                            |
|               | =nbits=        | (optional) integer                             | Number of bits used for the command. Not required if constant for a protocol with no variants                                                                                                                                                                                                |
|               | =repeats=      | integer                                        | Number of repeats to send with the command.                                                                                                                                                                                                                                                  |
|               | =category=     | (optional) string                              | A comma delimited string representing the set of standard functional categories that the command belongs to. Two categories are currently supported: /on/ and /off/. For example a "power on" command would support the /on/ category, while "power toggle" would be categorized as /on,off/ |
|               | =map_short=    | (optional) enum(string)                        | The default key associated with the command on the remote for a "short" press. See [[id:53fa51e9-bc4f-4167-af8b-1897fcb9ebd4][Keys]] for the list of supported key designations. This will be used when the device is accessed via the "Device List GUI" or if a scene uses the =keys_default= attribute pointing to the parent device.  |
|               | =map_long=     | (optional) enum(string)                        | The default key associated with the command on the remote for a "long" press. See [[id:53fa51e9-bc4f-4167-af8b-1897fcb9ebd4][Keys]] for the list of supported key designations. This will be used when the device is accessed via the "Device List GUI" or if a scene uses the =keys_default= attribute pointing to the parent device.  |
|---------------+----------------+------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| =scenes=      |                | dictionary: string -> =scene=                  | A dictionary mapping a string representing the unique identifier for a scene to a corresponding =scene= object                                                                                                                                                                               |
|---------------+----------------+------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| =scene=       | =display_name= | string                                         | The name used for this scene in UI                                                                                                                                                                                                                                                           |
|               | =keys_default= | (optional) string                              | The unique identifier of a =device= section to be used as source for default physical key mapping in the scene (as retrieved from =command= attributes)                                                                                                                                      |
|               | =keys_short=   | (optional) dictionary: string -> =command_ref= | A dictionary mapping physical key designators (see [[id:53fa51e9-bc4f-4167-af8b-1897fcb9ebd4][Keys]]) to corresponding  commands (via =command_ref= structures) that should be triggered on short press while the scene is active. Any key mappings define here overwrite the default definition inherited via =keys_default=.          |
|               | =keys_long=    | (optional) dictionary: string -> =command_ref= | A dictionary mapping physical key designators (see [[id:53fa51e9-bc4f-4167-af8b-1897fcb9ebd4][Keys]]) to corresponding  commands (via =command_ref= structures) that should be triggered on long press while the scene is active. Any key mappings define here overwrite the default definition inherited via =keys_default=.           |
|               | =start=        | list: =command_ref= \vert =delay=              | A sequence of device commands (represented via =command_ref= structures) or delays (represented via =delay= structure) to be executed when the scene starts.                                                                                                                                 |
|               | =end=          | list: =command_ref= \vert =delay=              | A sequence of device commands (represented via =command_ref= structures) or delays (represented via =delay= structure) to be executed when the scene ends.                                                                                                                                   |
|               | =shortcuts=    | list: =command_ref=                            | A list of commands (represented by =command_ref= structures) to be presented on this scene's GUI as buttons.                                                                                                                                                                                 |
|---------------+----------------+------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| =command_ref= | =device=       | string                                         | The unique identifier of the device (see =devices=) that this reference points to.                                                                                                                                                                                                           |
|               | =command=      | string                                         | The name of the =command= with the device's =commands= list that this reference points to. This attributre is only allowed if =device= attribute is present.                                                                                                                                 |
|               | =scene=        | string                                         | The =display_name= valye of the =scene= to be activated. This attribute is only allowed if neither =device= nor =command= is present.                                                                                                                                                        |
|---------------+----------------+------------------------------------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| =delay=       |                | integer                                        | The number of milliseconds to delay before executing the next step of a sequence.                                                                                                                                                                                                            |

*** Keys
:PROPERTIES:
:ID:       53fa51e9-bc4f-4167-af8b-1897fcb9ebd4
:END:
The designators for physical keys used in the configuration YAML scheme. Abbreviations are used to limit the amount typing required when authoring a configuration.
 - OFF
 - STOP
 - REWI
 - PLAY
 - FORW
 - CONF
 - INFO
 - UP
 - DOWN
 - LEFT
 - RIGHT
 - OK
 - BACK
 - SRC
 - VOLUP
 - VOLDO
 - MUTE
 - REC
 - CHUP
 - CHDOW
 - RED
 - GREEN
 - YELLO
 - BLUE

* Example   
#+begin_src yaml
scenes:
  watch_tv:
    display_name: Watch TV
    keys_default: sony_bravia
    shortcuts:
      - device: sony_bravia
        command: Netflix
      - device: sony_bravia
        command: Swap
        
    keys_short:
      UP:
        device: sony_bravia
        command: Down
      DOWN:
        device: sony_bravia
        command: Up
    start:
      - device: sony_bravia
        command: Power

  watch_tv_receiver:
    display_name: Watch TV Receiver
    keys_default: sony_bravia    
    keys_short:
      VOLUP:
        device: denon_x4700h
        command: Volume Up
      VOLDO:
        device: denon_x4700h
        command: Volume Down
      MUTE:
        device: denon_x4700h
        command: Mute
      
    start:
      - device: sony_bravia
        command: Power        
      - delay: 500
      - device: denon_x4700h
        command: Power Toggle
      - device: denon_x4700h
        command: Input TV
     
      
devices:
  denon_x4700h:
    display_name: Denon Receiver
    protocol: DENON
    commands:
    - name: Power Toggle
      data: "0x2A4C028A0088"
      nbits: 48
      repeats: 0
      category: on,off
      map_short: OFF
    - name: Volume Up
      data: "0x2A4C0280E86A"
      nbits: 48
      repeats: 0
      map_short: VOLUP
    - name: Volume Down
      data: "0x2A4C0288E862"
      nbits: 48
      repeats: 0
      map_short: VOLDO
    - name: Input TV
      data: "0x2A4C0284B432"
      nbits: 48
      repeats: 0
      
  sony_bravia:
    display_name: Sony Bravia
    protocol: SIRC    
    commands:
    - name: Power
      data: '0xA90'
      nbits: 12
      map_short: OFF
      category: on,off
    - name: Input
      data: '0xA50'
      nbits: 12
      map_short: SRC
    - name: Home
      data: '0x070'
      nbits: 12
      map_short: INFO
    - name: Apps
      data: '0x2A23'
      nbits: 15
    - name: Tv
      data: '0x250'
      nbits: 12
    - name: Left
      data: '0x2D0'
      nbits: 12
      map_short: LEFT
    - name: Right
      data: '0xCD0'
      nbits: 12
      map_short: RIGHT
    - name: Up
      data: '0x2F0'
      nbits: 12
      map_short: UP
    - name: Down
      data: '0xAF0'
      nbits: 12
      map_short: DOWN
    - name: Enter
      data: '0xA70'
      nbits: 12
      map_short: OK
    - name: Back
      data: '0x62E9'
      nbits: 15
      map_short: BACK
    - name: Mute
      data: '0x290'
      nbits: 12
      map_short: MUTE
    - name: Vol Up
      data: '0x490'
      nbits: 12
      map_short: VOLUP
    - name: Vol Down
      data: '0xC90'
      nbits: 12
      map_short: VOLDO
    - name: Netflix
      data: '0x1F58'
      nbits: 15
    - name: Swap
      data: '0xDD0'
      nbits: 12
  
#+end_src
